# üîî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è NutriChecker

## üìã –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å–æ—Å—Ç–æ–∏—Ç –∏–∑:
- **React Native –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** - –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **Supabase** - —Ö—Ä–∞–Ω–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Ç–æ–∫–µ–Ω—ã –∏ –¥–∞–Ω–Ω—ã–µ
- **N8N** - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ª–æ–≥–∏–∫—É –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **Expo Push Service** - –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

## üöÄ –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. üì± –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ)

‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø–∞–∫–µ—Ç—ã:
```bash
npx expo install expo-notifications expo-device expo-constants
```

‚úÖ –°–æ–∑–¥–∞–Ω —Å–µ—Ä–≤–∏—Å `services/pushNotifications.ts`
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ `_layout.tsx`
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–µ—Å—Ç–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 2. üóÑÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase

#### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
1. –û—Ç–∫—Ä–æ–π Supabase Dashboard
2. –ü–µ—Ä–µ–π–¥–∏ –≤ SQL Editor
3. –í—ã–ø–æ–ª–Ω–∏ —Å–∫—Ä–∏–ø—Ç –∏–∑ —Ñ–∞–π–ª–∞ `supabase_setup.sql`

#### –®–∞–≥ 2: –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–µ–π
1. –í Supabase Dashboard ‚Üí Settings ‚Üí API
2. –°–∫–æ–ø–∏—Ä—É–π:
   - **URL**: `https://your-project.supabase.co`
   - **Service Role Key**: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`

### 3. üîÑ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ N8N

#### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ Credentials

**Supabase Credential:**
1. –í N8N ‚Üí Credentials ‚Üí Add Credential
2. –í—ã–±–µ—Ä–∏ "HTTP Request Auth"
3. –ù–∞—Å—Ç—Ä–æ–π:
   - Name: `Supabase NutriChecker`
   - Authentication: `Header Auth`
   - Header Name: `Authorization`
   - Header Value: `Bearer YOUR_SERVICE_ROLE_KEY`

**OpenAI Credential:**
1. Add Credential ‚Üí OpenAI
2. API Key: `sk-...`

#### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ Workflows

–°–æ–∑–¥–∞–π —Å–ª–µ–¥—É—é—â–∏–µ workflows –∏–∑ —Ñ–∞–π–ª–∞ `n8n_workflows.md`:

1. **Register Push Token** - `https://ttagent.website/webhook/register-push-token`
2. **Send Test Push** - `https://ttagent.website/webhook/send-test-push`
3. **Daily Advice** - Cron trigger (9:00 –∫–∞–∂–¥—ã–π –¥–µ–Ω—å)
4. **Disable Push** - `https://ttagent.website/webhook/disable-push`

### 4. üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –¢–µ—Å—Ç 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞
1. –ó–∞–ø—É—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
2. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ - –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è push —Ç–æ–∫–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å –≤ Supabase - –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å–∏ –≤ `users` –∏ `push_tokens`

#### –¢–µ—Å—Ç 2: –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
1. –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ"
2. –ß–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
3. –ü—Ä–æ–≤–µ—Ä—å –≤ Supabase —Ç–∞–±–ª–∏—Ü—É `sent_notifications`

#### –¢–µ—Å—Ç 3: –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Å–æ–≤–µ—Ç—ã
1. –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
2. –ó–∞–ø—É—Å—Ç–∏ workflow "Daily Advice" –≤—Ä—É—á–Ω—É—é
3. –î–æ–ª–∂–µ–Ω –ø—Ä–∏–π—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–æ–≤–µ—Ç

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤ Supabase:

```sql
-- –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ç–æ–∫–µ–Ω–∞–º–∏
SELECT COUNT(*) FROM active_users_with_tokens;

-- –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞ —Å–µ–≥–æ–¥–Ω—è
SELECT 
  notification_type,
  COUNT(*) as count,
  COUNT(CASE WHEN status = 'delivered' THEN 1 END) as delivered
FROM sent_notifications 
WHERE DATE(sent_at) = CURRENT_DATE
GROUP BY notification_type;

-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏
SELECT * FROM sent_notifications 
WHERE status = 'failed' 
ORDER BY sent_at DESC 
LIMIT 10;
```

### –õ–æ–≥–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:
- –û—Ç–∫—Ä–æ–π Metro bundler
- –°–º–æ—Ç—Ä–∏ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üîß Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –¢–æ–∫–µ–Ω –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å —Ä–µ–∞–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
- –ü—Ä–æ–≤–µ—Ä—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä—å Project ID –≤ `app.json`

### –ü—Ä–æ–±–ª–µ–º–∞: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å –≤ —Ç–∞–±–ª–∏—Ü–µ `sent_notifications`
- –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –∞–∫—Ç–∏–≤–µ–Ω –≤ `push_tokens`
- –ü—Ä–æ–≤–µ—Ä—å N8N workflow –Ω–∞ –æ—à–∏–±–∫–∏

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –≤ N8N
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å credentials (Supabase, OpenAI)
- –£–±–µ–¥–∏—Å—å, —á—Ç–æ webhook URLs –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
- –ü—Ä–æ–≤–µ—Ä—å —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö

## üéØ –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### 1. –¢–µ—Å—Ç–æ–≤—ã–µ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
```json
{
  "title": "üß™ –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ",
  "body": "Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç! üéâ",
  "data": {"type": "test"}
}
```

### 2. –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Å–æ–≤–µ—Ç—ã
```json
{
  "title": "ü•ó –í–∞—à –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Å–æ–≤–µ—Ç",
  "body": "–ù–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º...",
  "data": {"type": "nutrition_advice"}
}
```

### 3. –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ–± –∞–ª–ª–µ—Ä–≥–µ–Ω–∞—Ö
```json
{
  "title": "üö® –í–Ω–∏–º–∞–Ω–∏–µ: –∞–ª–ª–µ—Ä–≥–µ–Ω!",
  "body": "–í –ø—Ä–æ–¥—É–∫—Ç–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω –∞–ª–ª–µ—Ä–≥–µ–Ω: –ì–ª—é—Ç–µ–Ω",
  "data": {"type": "allergen_warning"}
}
```

### 4. –í—ã—Å–æ–∫–æ–∫–∞–ª–æ—Ä–∏–π–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã
```json
{
  "title": "‚ö†Ô∏è –í—ã—Å–æ–∫–æ–∫–∞–ª–æ—Ä–∏–π–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç",
  "body": "–®–æ–∫–æ–ª–∞–¥ —Å–æ–¥–µ—Ä–∂–∏—Ç 534 –∫–∫–∞–ª. –£—á—Ç–∏—Ç–µ —ç—Ç–æ –≤ —Ä–∞—Ü–∏–æ–Ω–µ!",
  "data": {"type": "high_calorie_warning"}
}
```

### 5. –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
```json
{
  "title": "üéâ –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!",
  "body": "–í—ã –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–ª–∏ —É–∂–µ 5 –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å–µ–≥–æ–¥–Ω—è!",
  "data": {"type": "achievement"}
}
```

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è:
- –í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ —á–∞—Å–æ–≤–æ–º—É –ø–æ—è—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ß–∞—Å—Ç–æ—Ç–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ/–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ)
- –¢–∏–ø—ã —Å–æ–≤–µ—Ç–æ–≤ (–ø–æ—Ö—É–¥–µ–Ω–∏–µ/–Ω–∞–±–æ—Ä –º–∞—Å—Å—ã/–ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ)

### –ê–Ω–∞–ª–∏—Ç–∏–∫–∞:
- A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è
- –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
- Apple Health / Google Fit
- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø—Ä–∏–µ–º–æ–≤ –ø–∏—â–∏
- –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –≤ Metro bundler
2. –ü—Ä–æ–≤–µ—Ä—å —Ç–∞–±–ª–∏—Ü—ã –≤ Supabase
3. –ü—Ä–æ–≤–µ—Ä—å execution logs –≤ N8N
4. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤—Å–µ credentials –∞–∫—Ç—É–∞–ª—å–Ω—ã

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ Push —Ç–æ–∫–µ–Ω—ã —à–∏—Ñ—Ä—É—é—Ç—Å—è –≤ –±–∞–∑–µ
- ‚úÖ API –∫–ª—é—á–∏ –≤ environment variables
- ‚úÖ Rate limiting –Ω–∞ webhooks
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ Row Level Security –≤ Supabase

---

**–ì–æ—Ç–æ–≤–æ!** üéâ –°–∏—Å—Ç–µ–º–∞ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. 