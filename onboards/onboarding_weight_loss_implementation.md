# Инструкция по реализации расширенного онбординга в NutriChecker

## Общая концепция
Эта инструкция описывает процесс внедрения расширенного персонализированного онбординга в NutriChecker. Онбординг будет адаптироваться под различные цели пользователя: снижение веса, поддержание текущего веса, набор мышечной массы, улучшение здоровья и отслеживание питания. Новый онбординг заменит существующий вариант "onboarding3".

## Структура проекта

Основные файлы, которые требуют изменений:

1. `/app/onboarding/index.tsx` - основной файл онбординга, который нужно модифицировать
2. `/app/settings/index.tsx` - страница настроек, куда нужно добавить доступ к профилю пользователя
3. `/app/firebase/config.ts` - конфигурация Firebase, включая настройки Remote Config

## Новые файлы, которые нужно создать:

1. `/app/settings/profile.tsx` - страница профиля пользователя с отображением введенных в онбординге данных
2. `/app/types/onboarding.ts` - типы данных для нового онбординга
3. `/app/components/WheelPicker.tsx` - компонент выбора числовых значений (возраст, рост, вес)
4. `/app/components/PaywallScreen.tsx` - компонент для Paywall
5. `/app/onboarding/personalized` - папка с компонентами персонализированного онбординга

## Ключевые изменения

### 1. Данные пользователя

Следующие данные будут собираться в процессе онбординга:

```typescript
interface UserProfile {
  // Основные антропометрические данные
  birthday: string;            // дата рождения в формате ISO (YYYY-MM-DD)
  height: number;              // рост в см
  gender: Gender;              // пол (female, male, non-binary, prefer-not-to-say)
  currentWeight: number;       // текущий вес в кг
  goalWeight: number;          // целевой вес в кг (при необходимости)
  
  // Цели и предпочтения
  primaryGoal: PrimaryGoal;    // Основная цель пользователя
  activityLevel: ActivityLevel; // Уровень физической активности
  dietPreference: DietPreference; // Предпочтения в питании
  mealFrequency: MealFrequency; // Частота приема пищи
  challenges: Challenge[];     // Основные препятствия
  
  // Психологический профиль
  stressResponse: string;      // Способ реагирования на стресс
  confidenceLevel: number;     // Уровень уверенности в достижении цели
  temptationResponse: string;  // Реакция на соблазны
  
  // Медицинские аспекты
  medicalConditions: string[]; // Медицинские состояния
  medications: string[];      // Принимаемые лекарства
  allergies: string[];        // Аллергии
  
  // Расчетные значения для персонализированного плана
  bmr?: number;              // Базовый метаболический уровень
  tdee?: number;             // Общий дневной расход энергии
  calorieTarget?: number;    // Целевое количество калорий
  macroTargets?: {           // Целевые макронутриенты
    protein: number;         // Белки (г)
    fat: number;             // Жиры (г)
    carbs: number;           // Углеводы (г)
  }
  
  // Дополнительные данные
  goalDate?: string;         // Ожидаемая дата достижения цели
  preferredLanguage?: string; // Предпочитаемый язык
}

// Типы целей пользователя
type PrimaryGoal = 
  | 'lose-weight'       // Снижение веса
  | 'maintain-weight'   // Поддержание веса
  | 'gain-muscle'       // Набор мышечной массы
  | 'improve-health'    // Общее улучшение здоровья
  | 'track-nutrition';  // Отслеживание питания
```

### 2. Хранение данных

Все данные пользователя будут сохраняться в AsyncStorage при завершении онбординга:

```typescript
await AsyncStorage.setItem('userProfile', JSON.stringify(userProfile));
await AsyncStorage.setItem('hasCompletedOnboarding', 'true');
```

### 3. Экраны онбординга

Онбординг будет адаптироваться в зависимости от выбранной пользователем цели. Главные цели, которые мы будем поддерживать:

- **Снижение веса** - полный процесс с расчетом дефицита калорий
- **Поддержание веса** - сбалансированное питание без дефицита или профицита
- **Набор мышечной массы** - умеренный профицит калорий и акцент на белки
- **Улучшение здоровья** - фокус на качестве питания, не на калориях
- **Отслеживание питания** - минимальный онбординг без расчетов

#### Общие экраны онбординга (для всех целей):

1. **Приветствие** - объяснение процесса создания персонализированного плана
2. **Дата рождения** - выбор с помощью компонента WheelPicker
3. **Рост** - выбор с переключением единиц измерения (см/футы)
4. **Пол** - выбор из вариантов: женский, мужской, небинарный, предпочитаю не указывать
5. **Текущий вес** - выбор с переключением единиц измерения (кг/фунты)
6. **Выбор цели** - ключевой экран, определяющий дальнейший путь онбординга

#### Дополнительные экраны для цели "Снижение веса":

7. **Целевой вес** - указание желаемого веса
8. **Темп снижения веса** - выбор интенсивности (0.25, 0.5, 0.75, 1 кг в неделю)
9. **Уровень активности** - для расчета дневных затрат энергии
10. **Выбор типа питания** - стандартное, вегетарианское, веганское, низкоуглеводное, кето
11. **Распределение приемов пищи** - выбор количества приемов пищи в день
12. **Психологический профиль** - реакция на стресс, уровень уверенности
13. **Препятствия** - выбор основных сложностей
14. **Расчет плана** - анимация генерации персонализированного плана
15. **Сводка плана** - показ рассчитанных значений и прогнозируемой даты достижения цели

#### Дополнительные экраны для цели "Набор мышечной массы":

7. **Целевой вес** - желаемый вес или % увеличения мышечной массы
8. **Интенсивность тренировок** - частота и тип тренировок
9. **Уровень потребления белка** - предпочтительный уровень белка на кг веса
10. **Распределение приемов пищи** - с уклоном на питание до/после тренировки
11. **Сводка плана** - показ рассчитанных значений с акцентом на белки

#### Дополнительные экраны для цели "Улучшение здоровья":

7. **Медицинские состояния** - выбор имеющихся заболеваний или состояний
8. **Аллергии и непереносимости** - список исключаемых продуктов
9. **Принимаемые лекарства** - список лекарств для учета взаимодействий
10. **Предпочтения в питании** - фокус на полезных продуктах и группах продуктов

#### Дополнительные экраны для цели "Поддержание веса":

7. **Уровень активности** - для расчета поддерживающего калоража
8. **Распределение макронутриентов** - предпочтительное соотношение белков/жиров/углеводов
9. **Сводка плана** - показ сбалансированного плана питания

#### Для цели "Отслеживание питания" - минимальный онбординг:

7. **Предпочтения по отслеживанию** - что именно пользователь хочет отслеживать

#### Общие завершающие экраны:

- **Paywall** - заглушка для будущего экрана подписки
- **Переход на главный экран** - завершение онбординга

### 4. Экран Paywall

Временный экран Paywall будет содержать:
- Заголовок "Paywall"
- Информацию о премиум-подписке
- Список преимуществ с иконками: персонализированный план питания, подробная аналитика, рекомендации
- Кнопку "Продолжить" для имитации покупки и перехода на главный экран
- Кнопку "Пропустить" для тестирования (будет легко удалить в будущем)
- Примечание, что в будущем здесь будет Paywall от Revenuecat

Дизайн экрана Paywall будет соответствовать общему минималистичному стилю приложения, без лишних теней, но с яркими акцентами для привлечения внимания.

### 5. Страница профиля в настройках

В раздел Settings будет добавлен новый пункт "Профиль пользователя", который будет вести на страницу со всеми данными, введенными в онбординге.

Страница профиля будет содержать следующие секции:

1. **Основные данные**
   - Возраст
   - Рост
   - Текущий вес
   - Пол

2. **Цели и предпочтения**
   - Основная цель
   - Целевой вес (если применимо)
   - Тип питания
   - Количество приемов пищи

3. **Персонализированный план** (для целей снижения/набора веса)
   - Рекомендуемое количество калорий
   - Распределение макронутриентов
   - Прогноз достижения цели

4. **Медицинская информация** (для цели улучшения здоровья)
   - Медицинские состояния
   - Аллергии
   - Принимаемые лекарства

Пользователь сможет редактировать любое значение, что приведет к перерасчету персонализированного плана.

## Настройка и тестирование

### Хардкодный режим для разработки

Для тестирования только нового персонализированного онбординга ("onboarding3") мы изменили файл `/app/onboarding/index.tsx`, чтобы он всегда показывал нужный нам онбординг, игнорируя настройки Firebase Remote Config.

```typescript
// Всегда отображаем новый онбординг "onboarding3" независимо от настроек Firebase
// Захардкожено для тестирования
if (!loading) {
  return <WeightLossOnboarding />;
}
```

Для возврата к режиму A/B тестирования необходимо заменить этот код на:

```typescript
if (currentVersion === 'onboarding3' && !loading) {
  return <WeightLossOnboarding />;
}
```

### Переключение между режимами

В процессе разработки мы используем хардкодный режим, чтобы всегда видеть новый онбординг. Когда разработка и тестирование будут завершены, мы переключимся на распределение через Firebase Remote Config и A/B тесты.

## Визуальный стиль

1. Минималистичный дизайн без карточек с тенями
2. Компактная компоновка с минимальными отступами
3. Яркие цветовые индикаторы:
   - Белки (P): 'rgba(255, 107, 107, 0.85)' - красный
   - Жиры (F): 'rgba(255, 209, 102, 0.85)' - желтый
   - Углеводы (C): 'rgba(6, 214, 160, 0.85)' - зеленый
4. Для интерактивных элементов - светло-синий цвет (#007AFF)

## План реализации

1. Создать базовые компоненты (WheelPicker, Paywall)
2. Модифицировать структуру онбординга в Firebase Remote Config
3. Обновить файл `index.tsx` в папке onboarding
4. Создать страницу профиля пользователя
5. Добавить в настройки ссылку на страницу профиля
6. Протестировать поэтапно каждую группу экранов

## Начальные значения для компонентов выбора

1. Возраст: 30 лет
2. Рост: 170 см
3. Вес текущий: 70 кг
4. Вес целевой: 65 кг
5. Активность: умеренная
