# Интеграция User ID с N8N Webhook

## Обзор

В приложение NutriChecker добавлена функциональность уникального ID пользователя, который теперь передается в webhook N8N при сканировании продуктов.

## Реализованная функциональность

### 1. Сервис управления User ID (`services/userService.ts`)

- **Генерация уникального ID**: Формат `YYYYMMDDHHMMSS` + 5 случайных цифр + `@nutrichecker.top`
- **Автоматическое сохранение** в AsyncStorage при первом запуске
- **Функции копирования** в буфер обмена
- **Инициализация** при загрузке приложения

### 2. Отображение в настройках (`app/settings/index.tsx`)

- Новая секция "User" в настройках
- Отображение сгенерированного ID
- Кнопка копирования с иконкой
- Уведомления об успешном копировании

### 3. Интеграция с N8N Webhook (`app/photo-analysis/index.tsx`)

**Добавлен новый параметр `userId` в webhook запрос:**

```typescript
// Получаем ID пользователя
const userId = await getUserId();
console.log('ID пользователя для webhook:', userId);

// Добавляем в параметры запроса
urlParams.append('userId', userId);
```

**Теперь webhook получает следующие параметры:**

- `imageUrl` - URL изображения продукта
- `language` - язык пользователя
- **`userId`** - уникальный ID пользователя (НОВЫЙ)
- `userProfile` - профиль пользователя
- `selectedAllergenIds` - выбранные аллергены
- `customAllergens` - кастомные аллергены
- `allergenDetails` - детали аллергенов

## Примеры ID пользователей

```
2024122615304512345@nutrichecker.top
2024122615304567890@nutrichecker.top
2024122615304598123@nutrichecker.top
```

## Инициализация

ID автоматически генерируется при первом запуске приложения в `app/_layout.tsx`:

```typescript
// Инициализируем ID пользователя (генерируется при первом запуске)
getUserId()
  .then((userId: string) => console.log('ID пользователя инициализирован:', userId))
  .catch((err: any) => console.error('Ошибка при инициализации ID пользователя:', err));
```

## Логирование

Все операции с User ID логируются в консоль:

- Генерация нового ID
- Инициализация при запуске
- Передача в webhook
- Копирование в буфер обмена

## Безопасность

- ID хранится локально в AsyncStorage
- Не содержит личную информацию
- Уникальный для каждой установки приложения
- Может быть регенерирован при необходимости

## Использование в N8N

N8N workflow теперь может использовать параметр `userId` для:

- Идентификации пользователей
- Аналитики использования
- Персонализации ответов
- Логирования активности 