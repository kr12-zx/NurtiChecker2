# AllerScan - Приложение для анализа ингредиентов продуктов

## Обзор проекта
AllerScan - это мобильное приложение, созданное с использованием React Native и Expo, которое позволяет пользователям сканировать этикетки продуктов и анализировать ингредиенты, чтобы получить подробную информацию об их влиянии на здоровье. Приложение помогает пользователям принимать обоснованные решения о продуктах, которые они потребляют, на основе медицинских рекомендаций и личных аллергенов.

## Основные функции

### 1. Сканирование и анализ продуктов
- Пользователи могут фотографировать этикетки продуктов или выбирать изображения из галереи
- Приложение использует Gemini AI (генеративный ИИ от Google) для анализа ингредиентов
- Анализ включает в себя определение:
  - Вредных ингредиентов (с низким/средним/высоким уровнем риска)
  - Аллергенов
  - Нейтральных ингредиентов
  - Полезных ингредиентов

### 2. Расчет оценки здоровья
- Каждый продукт получает оценку здоровья (от 0 до 100) на основе его ингредиентов
- При расчете учитываются:
  - Количество и степень вредности опасных ингредиентов
  - Наличие аллергенов
  - Наличие полезных ингредиентов

### 3. Управление аллергенами
- Пользователи могут указать свои личные аллергены в профиле
- Приложение проверяет продукты на наличие указанных пользователем аллергенов
- Поддержка распространенных аллергенов (глютен, лактоза, орехи и т.д.) и пользовательских аллергенов

### 4. История и избранное
- История сканирований сохраняется локально для дальнейшего использования
- Пользователи могут отмечать продукты как избранные для быстрого доступа
- Экран истории показывает предыдущие сканирования с названиями продуктов и датами

### 5. Аутентификация пользователей
- Firebase аутентификация для пользовательских аккаунтов
- Управление профилем с настраиваемыми параметрами

## Техническая архитектура

### Структура проекта

#### Директории и файлы
- `app/` - Основные экраны приложения и навигация
  - `(tabs)/` - Основные экраны с вкладками:
    - `index.tsx` - Домашний экран
    - `scan.tsx` - Экран сканирования
    - `results.tsx` - Экран результатов анализа
    - `history.tsx` - История сканирований
    - `profile.tsx` - Профиль пользователя
  - `onboarding/` - Экраны для первоначального знакомства новых пользователей
  - `auth.tsx` - Экран авторизации
  - `allergens.tsx` - Управление аллергенами
- `components/` - Многоразовые UI компоненты
  - `ui/` - Базовые UI элементы (кнопки, карточки и т.д.)
  - `SplashScreen.tsx` - Экран загрузки 
  - `HealthScore.tsx` - Компонент отображения оценки здоровья
  - `IngredientTag.tsx` - Компонент отображения тэгов ингредиентов
- `utils/` - Утилиты и сервисы
  - `api/` - Интеграция с API
    - `analyze.ts` - Логика анализа ингредиентов
  - `gemini/` - Интеграция с Google Gemini AI
    - `imageAnalysis.ts` - Анализ изображений с помощью Gemini AI
    - `config.ts` - Конфигурация Gemini API
  - `firebase/` - Сервисы Firebase
    - `storage.ts` - Функции для работы с Firebase Storage
  - `storage/` - Управление локальным хранилищем
    - `local.ts` - Функции для работы с AsyncStorage
  - `context/` - React контексты для управления состоянием
    - `ThemeContext.tsx` - Контекст для управления темой
    - `ScanContext.tsx` - Контекст для управления сканированиями
  - `types/` - TypeScript типы и интерфейсы
    - `ingredients.ts` - Типы для ингредиентов и анализа

### Frontend
- Построен на React Native и Expo
- Использует expo-router для навигации с табовой структурой
- Компоненты организованы в многоразовую структуру
- Поддержка тем (светлый/темный режим)

### Backend сервисы
- Firebase для:
  - Аутентификации
  - Хранения (для изображений)
  - Firestore (для данных)
  - Analytics (для отслеживания действий пользователей)
- N8n webhook интеграция для обработки
- Google Gemini AI для анализа изображений и текста

## Основные рабочие процессы

### 1. Процесс сканирования:
1. Пользователь делает фото или выбирает изображение из галереи
2. Изображение загружается в Firebase Storage
3. URL изображения отправляется на webhook N8n вместе с аллергенами пользователя
4. Gemini AI анализирует изображение и извлекает информацию об ингредиентах
5. Результаты сохраняются локально и отображаются на экране

### 2. Процесс анализа:
1. Ингредиенты классифицируются по категориям (вредные, аллергены, нейтральные, полезные)
2. Рассчитывается оценка здоровья на основе состава
3. Генерируется сводка о продукте
4. Предлагаются более здоровые альтернативы

### 3. Процесс онбординга:
1. Пошаговое знакомство с функциями приложения для новых пользователей
2. Последовательность экранов, представляющих основной функционал

## Ключевые файлы и их функции

### app/index.tsx
Точка входа в приложение, которая проверяет, прошел ли пользователь онбординг, и перенаправляет его на соответствующий экран.

### app/(tabs)/scan.tsx
Основной экран сканирования, где пользователи могут выбрать или сделать фото продукта для анализа.
Реализует логику:
- Выбора изображения из галереи
- Загрузки изображения в Firebase Storage
- Отправки данных на анализ
- Сохранения результатов
- Перехода к экрану результатов

### app/(tabs)/results.tsx
Экран отображения результатов анализа, показывающий:
- Название продукта
- Список ингредиентов с их классификацией
- Оценку здоровья
- Общее описание продукта
- Рекомендуемые альтернативы

### utils/api/analyze.ts
Модуль с логикой анализа продуктов:
- Расчет оценки здоровья на основе ингредиентов
- Генерация сводки о продукте
- Определение типов ингредиентов

### components/HealthScore.tsx
Компонент для визуализации оценки здоровья продукта в виде круговой диаграммы с цветовой индикацией.

## Использованные технологии
- TypeScript для типобезопасности
- React Native для кросс-платформенной разработки
- Expo фреймворк для упрощения разработки и деплоя
- Firebase для бэкенд-сервисов
- Google Gemini AI для анализа ингредиентов
- Локальное хранилище для сохранения пользовательских данных

## Инструкции по развертыванию

### Установка зависимостей
```bash
npm install
```

### Запуск приложения
```bash
npx expo start
```

Приложение помогает пользователям делать обоснованный выбор продуктов, предоставляя подробный анализ ингредиентов, влияние на здоровье и предупреждения об аллергенах через интуитивно понятный мобильный интерфейс. 