# üçΩÔ∏è Meal Dashboard Webhook Setup

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ —Å—ä–µ–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–∞—Ö –≤ N8N webhook –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç –ø—Ä–æ–¥—É–∫—Ç –≤ —Å–≤–æ–π –¥–Ω–µ–≤–Ω–∏–∫ –ø–∏—Ç–∞–Ω–∏—è.

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. N8N Workflow

–ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `n8n_workflows/6_add_meal_dashboard.json` –≤ –≤–∞—à N8N:

1. –û—Ç–∫—Ä–æ–π—Ç–µ N8N –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
2. Workflows ‚Üí Import from file
3. –í—ã–±–µ—Ä–∏—Ç–µ `6_add_meal_dashboard.json`
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Supabase credentials –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### 2. Webhook URL

**Endpoint:** `https://ttagent.website/webhook/add-meal`
**–ú–µ—Ç–æ–¥:** POST

### 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –î–∞–Ω–Ω—ã—Ö

Webhook –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–¥—É–∫—Ç–µ:

```json
{
  "userId": "2025052522330875258@nutrichecker.top",
  "dish": "–ì—Ä–µ—á–µ—Å–∫–∏–π –π–æ–≥—É—Ä—Ç",
  "grams": 150,
  "kcal": 120,
  "prot": 15,
  "fat": 5,
  "carb": 8,
  "sugar": 6,
  "fiber": 0,
  "sodium": 50,
  "glycemicIndex": 35,
  "saturatedFat": 3,
  "vitamins": ["Vitamin B12", "Calcium"],
  "minerals": ["Calcium", "Phosphorus"],
  "healthBenefits": ["–ü—Ä–æ–±–∏–æ—Ç–∏–∫–∏"],
  "healthConcerns": ["–í—ã—Å–æ–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∂–∏—Ä–æ–≤"],
  "overallHealthScore": 75,
  "recommendedIntakeDescr": "1-2 –ø–æ—Ä—Ü–∏–∏ –≤ –¥–µ–Ω—å",
  "packageInfo": "–ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –π–æ–≥—É—Ä—Ç 150–≥",
  "targetLanguage": "ru",
  "isSafeForUser": true,
  "allergenId": 1,
  "allergenName": "–ú–æ–ª–æ–∫–æ",
  "messageAllergen": "–°–æ–¥–µ—Ä–∂–∏—Ç –º–æ–ª–æ—á–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã",
  "recommendedIntakeMaxFrequency": "daily",
  "eaten_at": "2024-12-25T10:30:00.000Z",
  "eaten_day": "2024-12-25",
  "imageUrl": "https://example.com/yogurt.jpg",
  "ingredients": "–ú–æ–ª–æ–∫–æ, –∂–∏–≤—ã–µ –∫—É–ª—å—Ç—É—Ä—ã",
  "description": "–ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –≥—Ä–µ—á–µ—Å–∫–∏–π –π–æ–≥—É—Ä—Ç"
}
```

## üöÄ –ö–∞–∫ –†–∞–±–æ—Ç–∞–µ—Ç

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏:

1. **–î–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–∞ –≤ –¥–Ω–µ–≤–Ω–∏–∫** - —á–µ—Ä–µ–∑ —ç–∫—Ä–∞–Ω –ø—Ä–æ–¥—É–∫—Ç–∞ —Å –≤—ã–±–æ—Ä–æ–º –ø–æ—Ä—Ü–∏–∏
2. **–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–∞** - –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
3. **–†—É—á–Ω–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏** - —á–µ—Ä–µ–∑ dashboard (–µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

### –ö–æ–¥ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

–í `services/dailyNutrition.ts` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞:

```typescript
// –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É
await saveDailyNutrition(updatedData);

// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ webhook
try {
  const mealData = MealService.convertScanToMealData(product, servingMultiplier);
  const webhookSuccess = await MealService.addMealToDashboard(mealData);
  
  if (webhookSuccess) {
    console.log('–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ dashboard webhook');
  }
} catch (error) {
  console.error('–û—à–∏–±–∫–∞ webhook:', error);
  // –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### DEV –†–µ–∂–∏–º

–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –≤ DEV —Ä–µ–∂–∏–º–µ) –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ "Test Meal Webhook":

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Settings
3. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é "Development"
4. –ù–∞–∂–º–∏—Ç–µ "Test Meal Webhook"

### –†—É—á–Ω–æ–µ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```typescript
import { MealService } from './services/mealService';

// –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
const testData = {
  userId: '', // –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
  dish: '–¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç',
  grams: 100,
  kcal: 250,
  prot: 12,
  fat: 8,
  carb: 30
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
};

const success = await MealService.addMealToDashboard(testData);
```

## üìä –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö

–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `meals_scan` —Å–æ –≤—Å–µ–º–∏ –ø–æ–ª—è–º–∏:

- –û—Å–Ω–æ–≤–Ω—ã–µ –Ω—É—Ç—Ä–∏–µ–Ω—Ç—ã (kcal, prot, fat, carb, sugar, fiber, sodium)
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (vitamins, minerals, healthBenefits)
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (eaten_at, eaten_day, imageUrl, ingredients)
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–ª–ª–µ—Ä–≥–µ–Ω–∞—Ö (allergenId, allergenName, messageAllergen)

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```javascript
// –£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
console.log('–î–∞–Ω–Ω—ã–µ –æ –ø—Ä–æ–¥—É–∫—Ç–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ dashboard webhook');

// –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ dashboard webhook');
console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö –≤ webhook:', error);
```

### N8N Dashboard

1. –û—Ç–∫—Ä–æ–π—Ç–µ N8N
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ workflow "Add Meal Dashboard"
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
4. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### Supabase Dashboard

1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase –ø—Ä–æ–µ–∫—Ç
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Table Editor
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É `meals_scan`
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—É–ø–∞—é—Ç

## ‚ö†Ô∏è Troubleshooting

### –û—à–∏–±–∫–∞ 400: Missing required fields
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `userId` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –Ω–∞–ª–∏—á–∏–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π

### –û—à–∏–±–∫–∞ 500: Database error
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Supabase credentials –≤ N8N
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `meals_scan` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ service role

### Webhook –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å N8N —Å–µ—Ä–≤–µ—Ä–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ workflow –∞–∫—Ç–∏–≤–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL webhook

### –î–∞–Ω–Ω—ã–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –æ—à–∏–±–∫–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `MealService` –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö:

1. –û–±–Ω–æ–≤–∏—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `MealData` –≤ `services/mealService.ts`
2. –û–±–Ω–æ–≤–∏—Ç–µ N8N workflow
3. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ö–µ–º—É —Ç–∞–±–ª–∏—Ü—ã –≤ Supabase (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞
- –ü—Ä–∏ –æ—à–∏–±–∫–µ webhook –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É–≤–∏–¥–∏—Ç –æ—à–∏–±–∫—É
- –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è 